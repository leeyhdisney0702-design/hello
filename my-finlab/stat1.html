<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS-Stats çµ±è¨ˆå­¸å¯¦é©—å®¤</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .page { display: none; }
        .active { display: block; }
        .stat-card { transition: all 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-800">

    <div id="home-page" class="page active container mx-auto px-6 py-16">
        <header class="text-center mb-16">
            <h1 class="text-5xl font-black text-slate-900 mb-4">StatLab</h1>
            <p class="text-slate-500 text-lg">äº’å‹•å¼çµ±è¨ˆå­¸æ¢ç´¢å¹³å°</p>
        </header>
        
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6">
            <div onclick="showPage('desc')" class="stat-card cursor-pointer bg-white p-8 rounded-3xl shadow-sm border-b-8 border-blue-500">
                <div class="text-4xl mb-4">ğŸ“Š</div>
                <h2 class="font-bold text-xl">æ•˜è¿°çµ±è¨ˆ</h2>
                <p class="text-sm text-slate-400 mt-2">é›†ä¸­è¶¨å‹¢èˆ‡é›¢æ•£ç¨‹åº¦åˆ†æ</p>
            </div>
            <div onclick="showPage('prob')" class="stat-card cursor-pointer bg-white p-8 rounded-3xl shadow-sm border-b-8 border-emerald-500">
                <div class="text-4xl mb-4">ğŸ²</div>
                <h2 class="font-bold text-xl">æ©Ÿç‡</h2>
                <p class="text-sm text-slate-400 mt-2">å¸¸æ…‹åˆ†ä½ˆèˆ‡é˜å½¢æ›²ç·š</p>
            </div>
            <div onclick="showPage('sampling')" class="stat-card cursor-pointer bg-white p-8 rounded-3xl shadow-sm border-b-8 border-orange-500">
                <div class="text-4xl mb-4">ğŸ”„</div>
                <h2 class="font-bold text-xl">æŠ½æ¨£æ–¹æ³•</h2>
                <p class="text-sm text-slate-400 mt-2">ä¸­å¤®æ¥µé™å®šç†æ¨¡æ“¬</p>
            </div>
            <div onclick="showPage('estimate')" class="stat-card cursor-pointer bg-white p-8 rounded-3xl shadow-sm border-b-8 border-purple-500">
                <div class="text-4xl mb-4">ğŸ¯</div>
                <h2 class="font-bold text-xl">ä¼°è¨ˆ</h2>
                <p class="text-sm text-slate-400 mt-2">ä¿¡è³´å€é–“å€é–“ä¼°è¨ˆ</p>
            </div>
            <div onclick="showPage('test')" class="stat-card cursor-pointer bg-white p-8 rounded-3xl shadow-sm border-b-8 border-rose-500">
                <div class="text-4xl mb-4">âš–ï¸</div>
                <h2 class="font-bold text-xl">å‡è¨­æª¢å®š</h2>
                <p class="text-sm text-slate-400 mt-2">P-value èˆ‡ é¡¯è‘—æ€§æª¢å®š</p>
            </div>
        </div>
    </div>

    <main class="max-w-4xl mx-auto px-6 py-10">
        <button onclick="showPage('home-page')" class="mb-8 text-slate-400 hover:text-slate-800 transition flex items-center gap-2">
            <span>â†</span> è¿”å›é¦–é 
        </button>

        <div id="desc" class="page bg-white p-10 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-blue-500 pl-4">æ•˜è¿°çµ±è¨ˆ</h2>
            <div class="mb-6">
                <label class="block mb-2 text-sm font-medium">è¼¸å…¥æ•¸æ“š (ç”¨é€—è™Ÿéš”é–‹)</label>
                <input type="text" id="desc-input" value="10, 20, 15, 25, 30, 18, 22" class="w-full p-3 bg-slate-50 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none">
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8" id="desc-results">
                </div>
            <canvas id="descChart"></canvas>
        </div>

        <div id="prob" class="page bg-white p-10 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-emerald-500 pl-4">æ©Ÿç‡åˆ†ä½ˆ</h2>
            <div class="flex gap-6 mb-8">
                <div class="flex-1">
                    <label class="block text-sm">å¹³å‡å€¼ (Î¼)</label>
                    <input type="number" id="prob-mu" value="0" step="0.5" class="w-full p-2 border rounded-lg mt-1">
                </div>
                <div class="flex-1">
                    <label class="block text-sm">æ¨™æº–å·® (Ïƒ)</label>
                    <input type="number" id="prob-sigma" value="1" step="0.1" class="w-full p-2 border rounded-lg mt-1">
                </div>
            </div>
            <canvas id="probChart"></canvas>
        </div>

        <div id="sampling" class="page bg-white p-10 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-orange-500 pl-4">æŠ½æ¨£æ¨¡æ“¬ (CLT)</h2>
            <p class="mb-6 text-slate-500">æ¨¡æ“¬å¾ 0 åˆ° 100 çš„å‡å‹»åˆ†ä½ˆä¸­éš¨æ©ŸæŠ½æ¨£ 30 æ¬¡ä¸¦å–å¹³å‡ï¼Œé‡è¤‡ 500 æ¬¡ã€‚</p>
            <button onclick="simulateCLT()" class="bg-orange-500 text-white px-8 py-3 rounded-xl hover:bg-orange-600 transition shadow-lg shadow-orange-200">é–‹å§‹æ¨¡æ“¬</button>
            <canvas id="cltChart" class="mt-8"></canvas>
        </div>

        <div id="estimate" class="page bg-white p-10 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-purple-500 pl-4">åƒæ•¸ä¼°è¨ˆ</h2>
            <div class="p-6 bg-purple-50 rounded-2xl border border-purple-100 mb-6">
                <p class="text-slate-600 mb-2">95% ä¿¡è³´å€é–“ (Confidence Interval)</p>
                <h3 id="ci-display" class="text-3xl font-black text-purple-700">å°šæœªè¨ˆç®—</h3>
            </div>
            <p class="text-sm text-slate-400">â€» æ­¤è¨ˆç®—åŸºæ–¼ã€Œæ•˜è¿°çµ±è¨ˆã€åˆ†é ä¸­çš„æœ€æ–°è¼¸å…¥æ•¸æ“šã€‚</p>
        </div>

        <div id="test" class="page bg-white p-10 rounded-3xl shadow-xl">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-rose-500 pl-4">å‡è¨­æª¢å®š (Z-Test)</h2>
            <div class="space-y-4">
                <div class="flex items-center gap-4">
                    <span>è™›ç„¡å‡è¨­ Hâ‚€: Î¼ = </span>
                    <input type="number" id="h0-mu" value="18" class="p-2 border rounded-lg w-24">
                </div>
                <button onclick="runZTest()" class="bg-rose-500 text-white px-8 py-3 rounded-xl">åŸ·è¡Œæª¢å®š</button>
                <div id="test-result" class="mt-6 p-6 rounded-2xl font-mono text-sm"></div>
            </div>
        </div>
    </main>

<script>
    let charts = {};

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        // é é¢é€²å…¥æ™‚è‡ªå‹•è§¸ç™¼è¨ˆç®—
        if(pageId === 'desc') runDesc();
        if(pageId === 'prob') runProb();
        if(pageId === 'estimate') runEstimate();
    }

    // 1. æ•˜è¿°çµ±è¨ˆé‚è¼¯
    function runDesc() {
        const input = document.getElementById('desc-input').value.split(',').map(Number).filter(n => !isNaN(n));
        const mean = input.reduce((a, b) => a + b) / input.length;
        const sorted = [...input].sort((a, b) => a - b);
        const median = sorted.length % 2 === 0 ? (sorted[sorted.length/2-1] + sorted[sorted.length/2])/2 : sorted[Math.floor(sorted.length/2)];
        const std = Math.sqrt(input.reduce((s, x) => s + Math.pow(x - mean, 2), 0) / input.length);

        const resDiv = document.getElementById('desc-results');
        resDiv.innerHTML = `
            <div class="bg-blue-50 p-4 rounded-xl text-center"><span class="block text-xs text-blue-400">å¹³å‡</span><b class="text-xl">${mean.toFixed(1)}</b></div>
            <div class="bg-blue-50 p-4 rounded-xl text-center"><span class="block text-xs text-blue-400">ä¸­ä½æ•¸</span><b class="text-xl">${median.toFixed(1)}</b></div>
            <div class="bg-blue-50 p-4 rounded-xl text-center"><span class="block text-xs text-blue-400">æ¨™æº–å·®</span><b class="text-xl">${std.toFixed(2)}</b></div>
            <div class="bg-blue-50 p-4 rounded-xl text-center"><span class="block text-xs text-blue-400">æ¨£æœ¬æ•¸</span><b class="text-xl">${input.length}</b></div>
        `;
        renderChart('descChart', 'æ•¸æ“šåˆ†ä½ˆ', input, input.map((_,i) => i+1), 'bar', '#3b82f6');
    }

    // 2. æ©Ÿç‡é‚è¼¯
    function runProb() {
        const mu = parseFloat(document.getElementById('prob-mu').value);
        const sigma = parseFloat(document.getElementById('prob-sigma').value);
        const x = [], y = [];
        for(let i = mu - 4*sigma; i <= mu + 4*sigma; i += 0.1) {
            x.push(i.toFixed(1));
            y.push((1 / (sigma * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((i - mu) / sigma, 2)));
        }
        renderChart('probChart', 'å¸¸æ…‹åˆ†ä½ˆ PDF', y, x, 'line', '#10b981');
    }

    // 3. æŠ½æ¨£æ–¹æ³•æ¨¡æ“¬ (CLT)
    function simulateCLT() {
        const sampleMeans = [];
        for(let i=0; i<500; i++) {
            let sum = 0;
            for(let j=0; j<30; j++) sum += Math.random() * 100;
            sampleMeans.push(sum / 30);
        }
        // ç°¡å–®çš„åˆ†çµ„çµ±è¨ˆ
        const bins = {};
        sampleMeans.forEach(v => {
            const b = Math.round(v);
            bins[b] = (bins[b] || 0) + 1;
        });
        renderChart('cltChart', 'æ¨£æœ¬å¹³å‡å€¼çš„é »æ¬¡', Object.values(bins), Object.keys(bins), 'bar', '#f59e0b');
    }

    // 4. ä¼°è¨ˆé‚è¼¯
    function runEstimate() {
        const input = document.getElementById('desc-input').value.split(',').map(Number).filter(n => !isNaN(n));
        const n = input.length;
        const mean = input.reduce((a, b) => a + b) / n;
        const std = Math.sqrt(input.reduce((s, x) => s + Math.pow(x - mean, 2), 0) / (n - 1));
        const se = std / Math.sqrt(n);
        const z = 1.96; // 95% CI
        document.getElementById('ci-display').innerText = `[${(mean - z*se).toFixed(2)} , ${(mean + z*se).toFixed(2)}]`;
    }

    // 5. å‡è¨­æª¢å®šé‚è¼¯
    function runZTest() {
        const input = document.getElementById('desc-input').value.split(',').map(Number).filter(n => !isNaN(n));
        const h0 = parseFloat(document.getElementById('h0-mu').value);
        const mean = input.reduce((a, b) => a + b) / input.length;
        const std = 5; // å‡è¨­å·²çŸ¥æ¨™æº–å·®ç‚º 5
        const z = (mean - h0) / (std / Math.sqrt(input.length));
        const p = 2 * (1 - normalCDF(Math.abs(z))); // é›™å°¾

        const div = document.getElementById('test-result');
        div.className = p < 0.05 ? "mt-6 p-6 rounded-2xl bg-rose-50 text-rose-700" : "mt-6 p-6 rounded-2xl bg-slate-50 text-slate-700";
        div.innerHTML = `Z å€¼: ${z.toFixed(4)}<br>P å€¼: ${p.toFixed(4)}<br><br><b>${p < 0.05 ? "æ‹’çµ•è™›ç„¡å‡è¨­ (é¡¯è‘—)" : "ç„¡æ³•æ‹’çµ•è™›ç„¡å‡è¨­ (ä¸é¡¯è‘—)"}</b>`;
    }

    function normalCDF(x) {
        return (1 + Math.erf(x / Math.sqrt(2))) / 2;
    }
    Math.erf = function(x) {
        const a1 = 0.254829592, a2 = -0.284496736, a3 = 1.421413741, a4 = -1.453152027, a5 = 1.061405429, p = 0.3275911;
        const sign = x < 0 ? -1 : 1; x = Math.abs(x);
        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        return sign * y;
    };

    function renderChart(id, label, data, labels, type, color) {
        const ctx = document.getElementById(id).getContext('2d');
        if (charts[id]) charts[id].destroy();
        charts[id] = new Chart(ctx, {
            type: type,
            data: { labels: labels, datasets: [{ label: label, data: data, backgroundColor: color, borderColor: color, fill: type === 'line' ? false : true, tension: 0.4, pointRadius: 0 }] },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });
    }

    // ç›£è½æ©Ÿç‡åƒæ•¸è®ŠåŒ–
    document.getElementById('prob-mu').addEventListener('input', runProb);
    document.getElementById('prob-sigma').addEventListener('input', runProb);
</script>
</body>
</html>